<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fanqie.dc.bean.order.OrderStat.oms">

    <select id="getOrderStat" parameterType="com.fanqie.dc.bean.order.OrderStatBo" resultType="com.fanqie.dc.bean.order.OrderStat">
        select
            foo.pmsInnId as pmsInnId,
            sum(foo.checkInOrderNum) as checkInOrderNum,
            sum(foo.checkInOrderPrice) as checkInOrderPrice,
            sum(foo.checkOutOrderNum) as checkOutOrderNum,
            sum(foo.checkOutOrderPrice) as checkOutOrderPrice
        from (
            SELECT
                o.inn_id AS pmsInnId,
                COUNT (o. ID) AS checkInOrderNum,
                SUM (o.total_amount) AS checkInOrderPrice,
                0 as checkOutOrderNum,
                0 as checkOutOrderPrice
            FROM
              tomato_channel_main_order o
            WHERE
                o.order_time  &gt;= '${from} 00:00:00'
                AND o.order_time &lt; '${to} 00:00:00'
                AND o.status = '1'
                AND o.channel_id IN (
                    SELECT
                      i.ota_id
                    FROM
                      tomato_oms_ota_info i
                    WHERE
                      i.pid = 102
                      AND i.pid != i.ota_id
                )
          GROUP BY o.inn_id

          union all

            select
                o.inn_id AS pmsInnId,
                0 AS checkInOrderNum,
                0 AS checkInOrderPrice,
                COUNT (o. ID) AS checkOutOrderNum,
                SUM (o.total_amount) AS checkOutOrderPrice
            from
                tomato_channel_order co
                inner join tomato_channel_main_order o on o.id = co.main_id and o.status = '1'
                and o.channel_id IN (
                    SELECT
                      i.ota_id
                    FROM
                      tomato_oms_ota_info i
                    WHERE
                      i.pid = 102
                      AND i.pid != i.ota_id
                )
            where
                co.check_out_at &gt;= '${from} 00:00:00'
                AND co.check_out_at &lt; '${to} 00:00:00'
            GROUP BY o.inn_id
        ) as foo
        group by pmsInnId
    </select>

</mapper>