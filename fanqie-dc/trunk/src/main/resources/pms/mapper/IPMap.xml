<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fanqie.dc.domain.IPEntity">
   <resultMap id="mapId" type="com.fanqie.dc.domain.IPEntity">
        <result column="id" property="id"/>
        <result column="ip" property="ip"/>
        <result column="port" property="port"/>
        <result column="status" property="status"/>
        <result column="ip_type" property="ipType"/>
   </resultMap>

    <insert id="saveBatchIp" parameterType="java.util.Map">
        insert into sys_proxy_ip(ip,port,status,ip_type) values
        <if test="ipList.size() > 0">
            <foreach collection="ipList" item="ip" separator=","  >
                ( '${ip.ip}','${ip.port}',1,<if test="ip.ipType!=null">'${ip.ipType}'</if><if test="ip.ipType==null">#{ip.ipType}</if>)
            </foreach>
        </if>

    </insert>
    <update id="updateBatchIp" parameterType="java.util.Map">
        <if test="ipList.size() > 0">
            <foreach collection="ipList" item="ip" separator=";"  >
                UPDATE sys_proxy_ip
                SET ip='${ip.ip}',
                `port`='${ip.port}',
                ip_type=<if test="ip.ipType!=null">'${ip.ipType}'</if><if test="ip.ipType==null">#{ip.ipType}</if>
                where id=#{ip.id}
            </foreach>
        </if>
    </update>

    <delete id="deletedIds" parameterType="java.util.Map">
        <if test="ipList.size() > 0">
            DELETE from sys_proxy_ip where id in
            <foreach collection="ipList" item="ip" open="(" separator="," close=")" >
                #{ip.id}
            </foreach>
        </if>
    </delete>

    <insert id="insert" parameterType="com.fanqie.dc.domain.IPEntity">
        insert into sys_proxy_ip(ip,port,status,ip_type) values
        ( '${ip}','${port}',1,<if test="ipType!=null">'${ipType}'</if><if test="ipType==null">#{ipType}</if>)
    </insert>

    <select id="findAll" resultMap="mapId">
        SELECT  * from sys_proxy_ip
    </select>

    <select id="findValidIp" parameterType="java.util.Map"  resultMap="mapId">
        SELECT  * from sys_proxy_ip where 1=1
         <if test="type != null">
            and ( ip_type = '${type}' or ip_type is null)
         </if>
        <if test="limit !=null">
            ORDER BY random()  limit #{limit};
        </if>
        <if test="limit ==null">
            ORDER BY random()  limit 1;
        </if>
    </select>

    <delete id="delete" parameterType="com.fanqie.dc.domain.IPEntity">
        DELETE from sys_proxy_ip where id=#{id}
    </delete>

    <update id="update" parameterType="com.fanqie.dc.domain.IPEntity">
      update sys_proxy_ip set ip_type=#{ipType} where id=#{id}
    </update>

</mapper>